---
title             : "Contextual cuing in the presence of an overt instruction"
shorttitle        : "Contextual cuing and instruction"
author: 
  - name          : "Tom Beesley"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Department of Psychology, Lancaster University, UK, LA1 4YD"
    email         : "t.beesley@lancaster.ac.uk"
  - name          : "Louise Earl" 
    affiliation   : "1"
  - name          : "Hope Butler" 
    affiliation   : "1"
  - name          : "Inez Sharp" 
    affiliation   : "1"
  - name          : "Ieva Jaceviciute" 
    affiliation   : "1"
  - name          : "David Luque" 
    affiliation   : "2"
affiliation:
  - id            : "1"
    institution   : "Lancaster University, UK"
  - id            : "2"
    institution   : "Universidad de Málaga, Spain"
abstract: |
  Three experiments explored the interaction between an endogenous cue of attention and the repetition of a visual search display during contextual cuing. In Experiment 1, participants readily learnt about repeated configurations of visual search, before being presented with an endogenous cue for attention towards the target on every trial. Participants used this cue to improve search times, but the repeated contexts continued to guide attention. Experiment 2 explored whether the presence of the endogenous would impede the acquisition of contextual cuing. It was found that contextual cuing was as strongly acquired in the presence and the absence of the endogenous cue. Experiment 3 confirmed the hypothesis that the contextual cuing relies largely on localised distractor contexts. Together, the experiments point towards a seamless interplay between two drivers of attention: visual search was initially guided by the presence of the endogenous cue and then refined by the repeated configurations to facilitate target detection. 
  
  Public significance statement: 
keywords          : "keywords"
wordcount         : "X"
bibliography      : ["references.bib"]
figsintext        : yes
floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no
header-includes:
  - \raggedbottom
  - \usepackage[font={small,it}, labelfont={bf}]{caption}
csl               : "apa7.csl"
documentclass     : "apa7"
classoption       : "man"
output            : papaja::apa6_pdf
editor_options: 
  chunk_output_type: console
---

```{r knitr-options}
knitr::opts_chunk$set(warning=FALSE, 
                      message=FALSE, 
                      include=FALSE,
                      dev = "cairo_pdf")
```

```{r rmd-setup, include = FALSE}
library(tidyverse)
library(citr)
library(papaja)
library(english)
library(extrafont)
library(afex) 
library(BayesFactor)
library(apa)
library(pwr) # power calculations
library(lsr) # effect size estimate
library(patchwork)

# function used to set rounding and presentation of decimals to specific length
spec_dec <- function(x, k) trimws(format(round(x, k), nsmall=k)) # useful for controlling decimals

# function to force scientific formatting of numbers (used for large BFs)
changeSciNot <- function(n) {
  output <- format(n, scientific = TRUE, digits = 2) #Transforms the number into scientific notation even if small
  output <- sub("e", " × 10^", output) #Replace e with 10^
  output <- sub("\\+0?", "", output) #Remove + symbol and leading zeros on exponent, if > 1
  output <- sub("-0?", "-", output) #Leaves - symbol but removes leading zeros on exponent, if < 1
  output <- paste0(output,"^") # makes the exponent superscript
  output
}

#setwd(dirname(rstudioapi::getActiveDocumentContext()$path)) # set wd to current file location

# function to extract and report BFs with error %s
report_BF_and_error <- function(BF_in, sci_not = TRUE, hyp = "alt"){
  
  if (hyp == "alt") {
    BF_notation = "BF~10~ = "
  } else if (hyp == "null") {
    BF_notation = "BF~01~ = "
  } else if (hyp == "mc") {
    BF_notation = "BF = "
  }
  
  if (sci_not == TRUE) {
    BF_value = changeSciNot(extractBF(BF_in)$bf) # change to sci notation
  } else {
    BF_value = round(extractBF(BF_in)$bf,2) # otherwise round
  }
  
  paste0(BF_notation, 
         BF_value, 
         " &plusmn; ", 
         round(100*extractBF(BF_in)$error,2), 
         "%")
}

```


```{r set_ggplot_theme}

# set global ggplot theme properties

theme_set(theme_classic(base_size = 14))

theme_update(axis.title = element_text(face = "bold", size = 14),
             axis.text = element_text(size = 12),
             legend.text = element_text(size = 12),
             legend.spacing.x = unit(0.4, "cm"))

cbPalette <- c("#C1272D", "#E69F00", "#56B4E9", "#008176", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")



```

It is well established that the process of visual search is guided by past experience. When we encounter a scene, the extent to which the configuration of stimuli matches stored representations in memory will determine the effectiveness of the processing and subsequent search through the elements of that scene. This cognitive process is studied in the lab using the contextual cuing (CC) task: participants typically experience a standard visual search task (i.e., serial processing; slow search), such as searching for a T amongst L shapes. A set of search configurations is repeated across trials, and response times to targets are faster compared to those in configurations that do not repeat. Thus, the repetition of the search configurations leads to a stored representation of (some aspect of) the configuration in memory, and future processing of the same configuration activates the memory representation, driving more efficient search behaviour within that scene.

Much work has focused on the nature of the memory and attention processes responsible for contextual cuing. The effect was initially suggested to be implicit in nature, with repeated configurations seemingly guiding search unconsciously: typically participants are unable to articulate their knowledge of the repeated configurations, and show poor ability to recognise configurations in memory tests [e.g., @chun1998; @colagiuri2016], although this view of CC has been strongly contested [e.g., @smyth2008; @vadillo2016]. There are also a number of plausible models of how memory representations of repeated configurations might guide search [e.g., @beesley2015b; @brady2007], with the predominant view being that the memory representations are best characterised as associative in nature, whereby distractors [or groups of distractors, see @beesley2016] form associations that activate more likely target positions.

The exact nature of how repeated configurations facilitate visual search is also the focus of much debate within the literature. There is a question as to whether CC reflects enhanced attentional processing of the display, such as by reducing the number of distractors processed [e.g., @beesley2018], or whether it facilitates the decision process once targets have been detected [e.g, @kunar2007; @sewell2018]. The current article focuses on the assumed attentional advantage for repeated configurations, and explores the extent to which this results in an automatic form of attentional bias. That is, to what extent does the processing of the search configuration control the guidance of attention, and to what extent does that guidance persist even in the presence of other top-down control processes that might be driving attention.

A number of studies have explored how flexible the learned behaviours are in contextual cuing. For example, a number of studies have shown that moving the target to a new position within the display will abolish the established CC effect [@makovski2011; @manginelli2009]. Notably, @zellin2013 explored the remapping of target positions over a longer training period, observing that with extended training, new associations will form for these new target positions, though the effects are limited to targets that appear closer to those that are initially trained. This suggests that any relocation effect is driven strongly by a generalisation of the pre-existing associations. Furthermore, strong contextual cuing effects were observed for the initially trained targets in a final "return phase" at the end of the experiment. All of these results point towards CC constituting a fairly inflexible behaviour that is activated somewhat automatically during search.

More direct examination of the role of top-down control processes on CC comes from @luque2017b (Experiment 3). They used a task in which participants were initially given a standard CC experiment (search for a T amongst Ls), before then being told in a second phase that the target would appear in two designated positions along the horizontal mid-line of the screen. Participants were given an explicit instruction to search in these two locations for a new target (a Y); in this phase participants engaged in a new search task requiring controlled attention to specified locations. Yet the underlying configuration of repeated distractors was still present, as was the original target, which appeared in its trained location for that configuration. Luque et al. found that the acquired knowledge of the configurations did not affect performance in this second phase: responses to the new target were comparable when the old target was pointed in either the same or opposite direction to the new target, suggesting that there was no detectable processing of the old target [see also @luque2021]. The suggestion is that contextual cuing can be controlled in the presence of a top-down instruction to search in a new location - search is not automatic in nature in the CC task.

One potential issue with the studies presented by Luque and colleagues [@luque2017b; @luque2021] is that participants are instructed to engage in a new search process for a new target object: participants initially search for a T and are later instructed to search for a Y. The role of a prior target template is important for visual search [@vickery2005; @vo2012], and object identities appear to play an important role in the contextual cuing effect [@makovski2017; @makovski2018]. While it is unclear how dependent CC is on the identity of the target, it is possible that distractor-target associations may well be sensitive to target identity and to the goals of the participant. For this reason, the current study assesses the impact of top-down instruction on CC when participants maintain the same task goal of searching for a single target identity within the display.

The overarching aim of the current study is to explore the interaction between controlled (top-down) attentional processes and the pattern of search behaviour established by the repeated configurations. Specifically we seek to understand whether repeated configurations continue to guide attention even when participants are directed to alter their natural search patterns by the presence of an endogenous cue. The experiments explore both the performance aspect of CC in terms of whether it continues to guide behaviour once an endogenous cue is introduced, and also whether the development of the search behaviour is impeded when trained concurrently with the endogenous cue.

```{r exploratory_anaysis}

data_raw <- readRDS("combinedData.rds")

# get summary stats 

# how many participants in each experiment
data_raw %>%
  group_by(exp) %>% 
  summarise(num_Ps = n_distinct(subj))

# mean RT by participant
summary_rt <- 
  data_raw %>% 
  filter(timeout == 0,
         acc == 1) %>% 
  group_by(exp, subj) %>% 
  summarise(meanRT = mean(RT))

# plot as violin
summary_rt %>% 
  ggplot(aes(x = exp, y = meanRT)) +
  geom_violin(aes(fill = exp)) +
  geom_dotplot(binaxis = "y",
               stackdir = "center",
               dotsize = 2,
               binwidth = 25,
               alpha = .3)

# mean acc by participant
summary_acc <- 
  data_raw %>% 
  filter(timeout == 0) %>% 
  group_by(exp, subj) %>% 
  summarise(meanAcc = mean(acc))

# plot as violin
summary_acc %>% 
  ggplot(aes(x = exp, y = meanAcc)) +
  geom_violin(aes(fill = exp)) +
  geom_dotplot(binaxis = "y",
               stackdir = "center",
               binwidth = .01,
               dotsize = 1,
               alpha = .3)


```

# Transparency and Openness

The raw data, analysis scripts, experimental materials, and the manuscript source files, are available at <http://github.com/tombeesley/CC_Control>. The analyses reported in this manuscript are computationally reproducible from the manuscript source files (using R v4.1.1), which are available at the github repository. The study design and analyses were not pre-registered.

# Experiment 1

Experiment 1 sought to examine whether the learnt attentional behaviour that develops during contextual cuing is expressed when participants are directed by an endogenous (instructional) cue to search in a particular region of the visual scene. Participants were first trained with a set of four repeating configurations in phase 1 across 5 epochs of 32 trials each. Then prior to phase 2, participants were told that an arrow would appear before every trial indicating the side of the screen on which the target would be located. This arrow was valid on every trial. In phase 2, the repeating configurations were presented in two forms: "consistent", where the target appeared in the same position as it has appeared for that configuration in phase 1; and "inconsistent", where the target appeared in a position in the opposite quadrant of the screen from where it had appeared in phase 1. Random configurations were also presented in this phase. If the contextual cues within the repeated configurations continue to guide attention in the presence of the instructional cue, then we would expect that response times would be faster on consistent trials compared to random trials. In addition, we would also expect that the contextual cues would guide attention *away* from the (new) target quadrant on inconsistent trials, and so response times should be slower on these trials compared to those on random trials.

## Method

### Participants

```{r demographics_exp1}

# get basic stats for Ps

data_exp1 <- 
  data_raw %>% 
  filter(exp == "CCC01")

# rename TT variable
data_exp1 <- 
  data_exp1 %>% 
  mutate(TT = fct_recode(TT, 
                         "Repeated: consistent" = "repeated_con",
                         "Repeated: inconsistent" = "repeated_incon",
                         "Random: consistent" = "random_con",
                         "Random: inconsistent" = "random_incon")) %>% 
  mutate(TT = fct_relevel(TT, 
                          "Repeated: consistent", 
                          "Repeated: inconsistent",
                          "Random: consistent",
                          "Random: inconsistent"))

demographics <- 
  data_exp1 %>% 
  group_by(subj) %>% 
  slice(1) %>% 
  select(subj, age, gender)

```

`r Words(nrow(demographics))` undergraduate students from Lancaster University were recruited (mean age = `r mean(demographics$age)`, SD = `r sd(demographics$age)`; `r count(demographics[,2:3], gender)[1,2]` identified as male and `r count(demographics[,2:3], gender)[2,2]` as female) via the Psychology Research Participation System in the Department of Psychology at Lancaster University, in return for the opportunity to use the recruitment system for their own research in future years.

### Materials

Participants were tested individually in a quiet room with a Dell laptop with a 15.6" screen, a screen resolution of 1920 x 1080, and a full size external keyboard for participants to use to respond to the task. Participants sat approximately 50 cm from the screen. Stimulus presentation was controlled by MATLAB using the Psychophysics Toolbox extensions (Brainard, 1997; Kleiner, Brainard & Pelli, 2007; Pelli, 1997). Responses to the target stimulus were made by pressing the 'c' or 'n' key on a standard keyboard. All experimental materials are available at the github repository for this study.

Distractor stimuli were an 'L' shape (rotated 0°, 90°, 180°, or 270°) while the target stimulus was a 'T' shape (rotated at either 90° or 270°). Stimuli were XX mm (X.X°) square and arranged in a square grid of 144 evenly spaced cells (12 x 12) which was positioned centrally on the screen and was XXX mm (XX°) square. The grid itself was invisible to participants. The fixation cross (displayed centrally before each trial) was XX mm (X.X°) square. The background of the screen was grey (RGB: .6, .6, .6) and the stimuli were presented in black (RGB: 1, 1, 1). There was a small offset in the vertical line of the 'L' distractors, which increased the similarity between the 'L' distractors and the target 'T', making the search task more difficult (Duncan & Humphreys, 1989).

### Design

Phase 1 employed a within-subjects design with factors of epoch (1-5) and configuration (repeated and random). All configurations contained 16 distractors, equally divided between the four quadrants of the display, and one target. Four repeated configurations were trained. Four target locations were used, with one from each quadrant assigned to each of the repeated configurations. These same four target positions were used for the random configurations throughout the task. Each of these four target positions was chosen at random from one of five locations within each quadrant, that were approximately equidistant from the center of the screen. Distractors could not appear in these target locations.

Phase 2 employed a within-subjects design with factors of epoch (6-10) and configuration (repeated: consistent; repeated: inconsistent; random: consistent; random:inconsistent). On each trial, there was a .5 probability that an "inconsistent" version of the configuration would be presented. This meant that the target was relocated to a diametrically opposed target position such as to maximise the displacement from the trained target position (see Figure \@ref(fig:schematicCC)). This could occur for both the repeated and random configurations, hence creating four unique trial types for this phase. While random configurations did not have a "trained", associated, target position, it is necessary to divide the random trials into consistent and inconsistent trial types in this way in order to assess any target frequency effects that may occur, since the inconsistent target locations used in this phase were novel.

(ref:schematicCC) Schematic of the manipulation of target position in consistent and inconsistent trials of Phase 2 

```{r schematicCC, out.width="75%", fig.align = "center", fig.cap="(ref:schematicCC)", include = TRUE}
knitr::include_graphics('Schematic.png')
```

### Procedure

Participants were tested individually in a quiet testing room. They were given instructions on how to complete the task, including the presentation of an example of a search trial. Participants were shown the two correct responses for the two possible orientations of targets.

Each trial commenced with a fixation cross presented in the center of the screen for 500 ms, which was then replaced immediately by the search configuration. Participants searched for the target stimulus and responded with a left or right response depending on its orientation. Reaction times (RTs) were recorded from the onset of the search configuration. Following a valid response (c or n), the configuration was removed from the screen. The response-- stimulus interval (hereafter RSI) was 1000 ms. If participants made an incorrect response to the target orientation, "INCORRECT RESPONSE" appeared in red in the center of the screen for 3000 ms, prior to the ITI. If participants did not respond within 6000 ms, "TIMEOUT - TOO SLOW" appeared in red in the center of the screen for 3000 ms, prior to the ITI.

Each block of eight trials contained each of the four different repeated configurations and four random configurations. These eight configurations could appear in any order with the constraint that the position of the target did not repeat across trials or across consecutive blocks.

A rest break of 30 seconds was given every 80 trials. Trials started automatically after these breaks.

After 160 trials, prior to phase 2, participants were given an instruction screen which detailed the arrow that would appear on the screen prior to the configuration. They were able to ask any questions they had at this stage and then proceeded to phase 2. The arrow appeared for 1000ms following the fixation cross, before the presentation of the search configuration. The task was otherwise identical to that used in phase 1.

## Results

```{r exclusions_exp1}

# participant exclusions 

to_summary <- 
  data_exp1 %>% 
  group_by(subj) %>% 
  summarise(meanTO = mean(timeout)) %>% 
  mutate(z_meanTO = scale(meanTO)[,1])

acc_summary <- 
  data_exp1 %>% 
  group_by(subj) %>% 
  summarise(meanAcc = mean(acc, na.rm = TRUE)) %>% 
  mutate(z_meanAcc = scale(meanAcc)[,1])

rt_summary <- 
  data_exp1 %>% 
  filter(acc == 1) %>% 
  group_by(subj) %>% 
  summarise(meanRT = mean(RT, na.rm = TRUE)) %>% 
  mutate(z_meanRT = scale(meanRT)[,1])

# combine these into one dataframe
resp_summary_exp1 <- 
  to_summary %>% 
  left_join(acc_summary, by = "subj") %>% 
  left_join(rt_summary, by = "subj")

# is anyone an outlier in terms of timeouts?
outlier_to <- 
  resp_summary_exp1 %>% 
  filter(z_meanTO < -2.5 | z_meanTO > 2.5)

# is anyone an outlier in terms of accuracy?
outlier_acc <- 
  resp_summary_exp1 %>% 
  filter(z_meanAcc < -2.5 | z_meanAcc > 2.5)

# is anyone an outlier in terms of rt?
outlier_rt <- 
  resp_summary_exp1 %>% 
  filter(z_meanRT < -2.5 | z_meanRT > 2.5)

participants_removed <- 
  bind_rows(outlier_to, outlier_acc, outlier_rt) %>% 
  select(subj) %>% 
  mutate(subj = as.character(subj)) %>% 
  unique() %>% 
  pull()



```

Our criterion for removing outlier data, at both the participant level and the trial level, was 2.5 standard deviations above or below the mean of the sample. On average, trials ended with a timeout on `r spec_dec(100*mean(resp_summary_exp1$meanTO),2)`% of trials (SD = `r spec_dec(100*sd(resp_summary_exp1$meanTO),2)`). `r Words(nrow(outlier_to))` participants had an usually high proportion of timeouts and were removed from the analysis. The mean accuracy of participants (not including timeout trials) was `r spec_dec(100*mean(resp_summary_exp1$meanAcc),2)`% (SD = `r spec_dec(100*sd(resp_summary_exp1$meanAcc),2)`%). `r Words(nrow(outlier_acc))` participant had an unusually low proportion of accurate trials and was also removed. The only participant deemed to be an outlier in terms of mean response time (hereafter RT) was also excluded on the basis of the timeout criterion, noted above.

```{r rm_outliers_exp1}

# remove the participant outliers from the data
data_exp1_OR <- 
  data_exp1 %>% 
  filter(!subj %in% participants_removed)

# remove the timeouts and inaccurate trials
data_exp1_OR <- 
  data_exp1_OR %>% 
  filter(timeout == 0,
         acc == 1) %>% 
  group_by(subj) %>% 
  mutate(zRT = scale(RT)[,1]) # calculate z scores on participant basis

# get a summary of the RT outlier removal
rt_outlier_summary <- 
  data_exp1_OR %>% 
  group_by(subj) %>% 
  summarise(prop_rem = mean(zRT < -2.5 | zRT > 2.5))

# was anyone an outlier in prop removed?
outlier_prop_removed <- 
  rt_outlier_summary %>% 
  mutate(z_prop_rem = scale(prop_rem)[,1]) %>% 
  filter(z_prop_rem < -2.5 | z_prop_rem > 2.5)

# remove the outlier RTs from the data 
data_e1_f <-
  data_exp1_OR %>%
  ungroup() %>%
  filter(zRT > -2.5 & zRT < 2.5) # keep data in this range

```

For the remaining `r words(nrow(rt_outlier_summary))` participants we removed trials with a timeout and inaccurate trials, before removing outliers from the RT data. On average, the proportion of outliers removed was `r spec_dec(100*mean(rt_outlier_summary$prop_rem),2)`% (SD = `r spec_dec(100*sd(rt_outlier_summary$prop_rem),2)`%). `r Words(nrow(outlier_prop_removed))` participants had an unusual proportion of trials removed as outlier RTs (greater than 2.5 SDs above the mean).

```{r rt_summary_exp1}
# compute grand mean RT 
grand_mean_e1 <- mean(data_e1_f$RT)

# create subj level mean and normalised RT variable
data_e1_f <- 
  data_e1_f %>%
  group_by(subj) %>% 
  mutate(subj_mean_rt = mean(RT),
         normRT = RT - subj_mean_rt + grand_mean_e1) %>% 
  select(-subj_mean_rt)

# summarise the data across the 10 epochs, by subj
rt_summary_data_e1 <- 
  data_e1_f %>% 
  group_by(subj, epoch, TT) %>% 
  summarise(meanRT = mean(RT),
            mean_norm_RT = mean(normRT)) # used for normalised SE bars

# # explore whether all Ps showed reduction in RTs phase 1 to phase 2 - yes they did
# data_e1_f %>% 
#   filter(epoch %in% c(4:7),
#          acc == 1) %>% 
#   group_by(subj, epoch) %>%
#   summarise(meanRT = mean(RT)) %>% 
#   pivot_wider(names_from = epoch, names_prefix = "epoch_", values_from = meanRT) %>% 
#   rowwise() %>% 
#   mutate(drop_in_RT = mean(c(epoch_4,epoch_5)) - mean(c(epoch_6,epoch_7)))

```

(ref:Exp1-RT-figure) RT data for Experiment 1. Within-subject error bars were computed by a process of normalising the RT data for the sample [@cousineau2005].

Figure \@ref(fig:Exp1-RT-figure) shows the RT data across the 10 epochs of the experiment. In phase 1 (epochs 1-5) a contextual cuing effect emerged, with faster responses to repeated over random configurations. In phase 2, the presence of the guiding arrow lead to a clear reduction in the response times. For all participants, the mean RT across epochs 4 and 5 was higher than the mean RTs across epochs 6 and 7. Despite the clear evidence for the processing of the endogenous cue, the underlying search configuration continued to play a role in the guidance of attention, with faster response times for (consistent) repeated configurations compared to random configurations.

```{r Exp1-RT-figure, fig.align="center", fig.cap="(ref:Exp1-RT-figure)", fig.dim=c(7,5), include = TRUE}

# summarise at the group level and plot
rt_all_exp1 <- 
rt_summary_data_e1 %>% 
  group_by(epoch, TT) %>% 
  summarise(group_RT = mean(meanRT),
            group_SE = sd(mean_norm_RT)/sqrt(n())) %>% 
  ggplot(aes(x = epoch, y = group_RT, group = TT)) +
  geom_line(size = .5) +
  geom_errorbar(aes(ymin = group_RT - group_SE,
                    ymax = group_RT + group_SE),
                width = .2,
                size = .5) +
  geom_point(aes(fill = TT),size = 5, shape = 21) +
  labs(y = "RT (ms)",
       x = "Epochs of 32 trials") +
  scale_fill_manual(name = "", 
                    values = cbPalette,
                    labels = c("Repeated: consistent",
                               "Repeated: inconsistent",
                               "Random: consistent",
                               "Random: inconsistent")) +
  theme(legend.position = c(0.25,.25),
        legend.direction = "vertical",
        plot.margin = unit(c(0,0.1,0.1,0.1),"inches")) +
  guides(fill = guide_legend(byrow = TRUE)) +
  scale_y_continuous(limits = c(1000, 2400), breaks = seq(1000, 2400, 200))

phase2_avg_col <- 
  rt_summary_data_e1 %>% 
  filter(epoch %in% c(6:10)) %>% 
  group_by(TT) %>% 
  summarise(group_RT = mean(meanRT),
            group_SE = sd(mean_norm_RT)/sqrt(n())) %>% 
  ggplot(aes(x = TT, y = group_RT, fill = TT)) +
  geom_errorbar(aes(ymin = group_RT,
                    ymax = group_RT + group_SE),
                width = .2,
                size = .5) +
  geom_col(colour = "black", size = 0.5, width = .8) +
  scale_fill_manual(name = "", 
                    values = cbPalette) +
  coord_cartesian(ylim = c(1200,1450)) +
  theme(legend.position = "None",
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        plot.title = element_text(size = 10, hjust = 0.5, face = "bold"),
        plot.background = element_rect(fill = "#f2f2f2", colour = "black"),
        panel.background = element_rect(fill = "#f2f2f2")) +
  labs(y = "RT (ms)",
       x = "Trial type",
       title = "Phase 2 averages")

layout <- c(
  area(t = 1, l = 1, b = 32, r = 32),
  area(t = 2, l = 23, b = 15, r = 31)
)

rt_all_exp1 + phase2_avg_col + plot_layout(design = layout)

```

```{r phase_1_BFs_exp1}
# Experiment 1 stats

# Statistics on Phase 1

phase_1 <- 
  rt_summary_data_e1 %>% 
  mutate(epoch = as.factor(epoch)) %>% 
  filter(epoch %in% c(1:5))

#exp1_phase1_anova <- aov_car(meanRT ~ Error(subj/TT*epoch), data = phase_1)

e1_phase1_BF <- 
  anovaBF(meanRT ~ TT * epoch + subj, 
          data = phase_1,
          whichRandom = "subj")

```

These data were analysed with a Bayesian ANOVA[^1], using the *BayesFactor::anovaBF()* function in R. All analyses in this study used the deafult parameters for the priors, which "places mass in reason-
able ranges [of effect sizes] without being overcommitted to any one point" [@rouder2017, p. 317]. First taking the data from phase 1 (epochs 1-5), the model with the largest Bayes Factor (BF) contained the factors of epoch and configuration (repeated vs. random), `r report_BF_and_error(e1_phase1_BF[3])`. The addition of the interaction term did not substantially improve the model fit, `r report_BF_and_error(e1_phase1_BF[4]/e1_phase1_BF[3], sci_not = FALSE, hyp = "mc")`. The best fitting model was a better fit than the two models containing only one of the factors, smallest `r report_BF_and_error(e1_phase1_BF[3]/e1_phase1_BF[1], sci_not = FALSE, hyp = "mc")`, providing significant support for the effects of configuration and epoch.

[^1]: The Bayesian analyses here follow the process outlined in @rouder2017. Briefly, we present the best fitting model, and then compare this fit to that of other models. Where the comparison of two models (i.e., A against B) reveals a Bayes Factor of greater than 3, this is taken as support for the components of model A that are not present in model B. Bayes Factors of less than 0.33 are taken as evidence in support of the equivalence of two models

```{r phase_2_BFs_exp1}
# Experiment 1 stats

# Statistics on Phase 2

phase_2 <- 
  rt_summary_data_e1 %>% 
  mutate(epoch = as.factor(epoch)) %>% 
  filter(epoch %in% c(6:10))

#exp1_phase1_anova <- aov_car(meanRT ~ Error(subj/TT*epoch), data = phase_1)

e1_phase2_BF <- 
  anovaBF(meanRT ~ TT * epoch + subj, 
          data = phase_2,
          whichRandom = "subj")

exp1_ttestBF_data <- 
  phase_2 %>% 
  group_by(subj, TT) %>% 
  summarise(meanRT=mean(meanRT)) %>% 
  pivot_wider(values_from = meanRT, names_from = TT) %>% 
  janitor::clean_names()

exp3_p2_repC_randC <- ttestBF(x = exp1_ttestBF_data$repeated_consistent, y = exp1_ttestBF_data$random_consistent, paired = TRUE)
exp3_p2_repI_randI <- ttestBF(x = exp1_ttestBF_data$repeated_inconsistent, y = exp1_ttestBF_data$random_inconsistent, paired = TRUE)
exp3_p2_repC_repI <- ttestBF(x = exp1_ttestBF_data$repeated_consistent, y = exp1_ttestBF_data$repeated_inconsistent, paired = TRUE)

```

A Bayesian ANOVA on the data from phase 2 (epochs 6-10) found significant support for the model containing the factor of configuration, `r report_BF_and_error(e1_phase2_BF[2], sci_not = FALSE)`. The next best fitting model contained the factor of epoch but was a substantially worse fit to the data, `r report_BF_and_error(e1_phase2_BF[3]/e1_phase2_BF[2], sci_not = FALSE)`. Thus there was considerable evidence for an effect of configuration, and evidence that there was no effect of epoch or an interaction between epoch and configuration.

To explore the differences in response times across the four trial types in phase 2, the data were averaged across the 5 epochs, and Bayesian t-tests were run using BayesFactor::ttestBF with the default Cauchy prior. This revealed support for a difference between the response times on "repeated: consistent" trials and those on the respective random trials (random: consistent), `r report_BF_and_error(exp3_p2_repC_randC, sci_not = FALSE)`. There was also evidence to suggest there was no difference between the response times for the "repeated: inconsistent" trials and the respective random trials, `r report_BF_and_error(exp3_p2_repI_randI, sci_not = FALSE)`. There was substantial support for a difference between the response times on repeated consistent and the repeated inconsistent trials, `r report_BF_and_error(exp3_p2_repC_repI, sci_not = FALSE)`.

```{r trad_ANOVA_phase_2_exp1}
# Statistics on Stage 2

phase_2 <- 
  rt_summary_data_e1 %>% 
  mutate(epoch = as.numeric(epoch)) %>% 
  filter(epoch > 5)

aov_car(meanRT ~ Error(subj/TT*epoch), data = phase_2)

# random vs consistent
RvC <- 
  phase_2 %>% 
  filter(TT %in% c("Random: consistent", "Repeated: consistent"))

t.test(meanRT ~ TT, data = RvC)

# random vs. inconsistent
RvI <- 
  phase_2 %>% 
  filter(TT %in% c("Random: inconsistent", "Repeated: inconsistent"))

t.test(meanRT ~ TT, data = RvI)

# consistent vs. inconsistent
CvI <- 
  phase_2 %>% 
  filter(TT %in% c("Repeated: consistent", "Repeated: inconsistent"))

t.test(meanRT ~ TT, data = CvI)

```

## Discussion

Experiment 1 sought to examine the consequence of an endogenous cue that prompts top-down control of the search process on contextual cuing. In phase 1 we established a robust contextual cuing effect. Following this, participants received instruction that each trial would be preceded by an arrow stimulus that would signal the side of the screen on which the target would appear. This cue was valid on all trials in phase 2. Consistent with these instructions and the processing of this cue, we observed substantially reduced search times in phase 2 compared to phase 1. The same set of repeated configurations were presented in Phase 2, but for half of the trials, the target was relocated to the diagonally opposed quadrant of the screen. Therefore, on these "repeated inconsistent" trials, the underlying configuration of distractors predicted the target in a location that opposed that of the (valid) endogenous cue. Across this phase we observed significant contextual cuing for the repeated consistent trials, demonstrating that the underlying configuration of distractors continued to guide attention in the presence of the endogenous cue. However, the repeated inconsistent trials did not lead to an impairment in response times relative to random trials, suggesting that the underlying configuration did not influence search on these trials.

# Experiment 2

In Experiment 1 we demonstrated that an established effect of contextual cuing is maintained even when attention is being guided by the presence of a valid endogenous cue. That is, we found that the *performance* of an established search behaviour in contextual cuing is not disrupted by concurrent top-down goals to guide attention in a controlled manner. In Experiment 2 we wanted to explore the *learning* of the contextual cue itself, examining whether the presence of a valid endogenous cue may limit the development of a contextual cuing effect. To do this, we trained each participant on two sets of repeating configurations. One of these sets was always presented in the presence of a valid endogenous cue, while the other set was always presented in the absence of the endogenous cue. The extent to which there is a "cue-competition" effect between the endogenous cue and the contextual cues can be examined by comparing the contextual cuing effect we observe for the two sets of configurations. Given the clear difference in RTs we observed in Experiment 1 between the trials with the endogenous cue present and the cue being absent, we anticipated the same difference in responding in Experiment 2. Therefore we also included a second phase of Experiment 2 in which we removed the endogenous cue entirely from the task. This second phase therefore allowed us to directly compare the contextual cuing for the two sets of configurations when RTs were at a comparable level.

"Cue-competition" effects have been examined previously in contextual cuing. @endo2004 trained participants with a contextual cuing task composed of distractor location configurations and repeating distractor identities. Their experiments suggested that the stronger configural (spatial) cue out-competed the cue provided by the distractor identities. Similarly, @kunar2014 found that when colour cues and configural cues both predicted the target location, configural cues were dominant and tended to overshadow the weaker colour cue. @beesley2012 looked at the cue-interaction effects *within* a configuration of distractors. Participants were first trained with half a configuration of repeating distractors that predicted the target (8 out of 16 distractors). In a later stage these distractors were paired with a new half-configuration, such that the whole configuration now predicted the same target location. In contrast to the predictions of the vast majority of models of contingency learning, learning about these new predictive distractors was facilitated, rather than impaired in this second phase (relative to a control condition). Thus, @beesley2012 found that cue-competition was not observed within a configuration of equally predictive distractors. Together these studies suggest that the spatial configuration serves as a strong cue for the target and will out-compete non-configural cues for access to the learning mechanism. The dominance of the configuration in these situations may therefore lead to the prediction that the endogenous cue would not "block" the learning of the configuration in this task.

## Method

### Participants

```{r demographics_exp2}

# get basic stats for Ps

data_exp2 <- 
  data_raw %>% 
  filter(exp == "CCC02") 

demographics <- 
  data_exp2 %>% 
  group_by(subj) %>% 
  slice(1) %>% 
  select(subj, age, gender)

```

`r Words(nrow(demographics))` undergraduate students from Lancaster University were recruited (mean age = `r mean(demographics$age)`, SD = `r sd(demographics$age)`; `r count(demographics[,2:3], gender)[1,2]` identified as male and `r count(demographics[,2:3], gender)[2,2]` as female) via the Psychology Research Participation System in the Department of Psychology at Lancaster University, in return for the opportunity to use the recruitment system for their own research in future years.

### Materials

Participants were tested in a quiet laboratory testing cubicle, with a standard PC and a 24" monitor set at a resolution of 1920 x 1080 pixels. All other materials and stimuli were identical to Experiment 1.

### Design

Four repeated configurations were created in an identical manner to those used in Experiment 1. For each participant, two of these configurations were used for the "cue-competition" condition, in which the arrow cue was presented before the configuration, while two were used for the "control" condition (no arrow presented). As in Experiment 1, the four repeated configurations were paired with unique target positions from each of the four quadrants. We counterbalanced the use of the target quadrants across the factors of configuration type (repeated and random) and cue condition (cue-competition and control). For half of the participants, targets in the top left and bottom right were used for the repeated configurations presented with the arrow (cue-competition) condition, with targets in the top right and bottom left used for repeated configurations in the no-arrow (control) condition. For these participants, random configurations presented with the arrow had targets in the top right and bottom left, and random configurations without the arrow had targets in the top left and bottom right. For the other half of the participants these assignments were reversed (repeated-arrow: top-right and bottom-left; repeated-no arrow: top-left and bottom-right; random-arrow: top-left and bottom-right; random-no arrow: top-right and bottom-left).

### Procedure

The procedure was the same as Experiment 1 with the following differences. Participants received 320 trials in total. For the first 160 trials, the arrow was presented for the relevant conditions. For the final 160 trials, the arrow was never presented. Rest breaks were given every 60 trials.

## Results

```{r exclusions_exp2}

# participant exclusions 

to_summary <- 
  data_exp2 %>% 
  group_by(subj) %>% 
  summarise(meanTO = mean(timeout)) %>% 
  mutate(z_meanTO = scale(meanTO)[,1])

acc_summary <- 
  data_exp2 %>% 
  group_by(subj) %>% 
  summarise(meanAcc = mean(acc, na.rm = TRUE)) %>% 
  mutate(z_meanAcc = scale(meanAcc)[,1])

rt_summary <- 
  data_exp2 %>% 
  filter(acc == 1) %>% 
  group_by(subj) %>% 
  summarise(meanRT = mean(RT, na.rm = TRUE)) %>% 
  mutate(z_meanRT = scale(meanRT)[,1])

resp_summary_exp2 <- 
  to_summary %>% 
  left_join(acc_summary, by = "subj") %>% 
  left_join(rt_summary, by = "subj")

# is anyone an outlier in terms of timeouts?
outlier_to <- 
  resp_summary_exp2 %>% 
  filter(z_meanTO < -2.5 | z_meanTO > 2.5)

# is anyone an outlier in terms of accuracy?
outlier_acc <- 
  resp_summary_exp2 %>% 
  filter(z_meanAcc < -2.5 | z_meanAcc > 2.5)

# is anyone an outlier in terms of rt?
outlier_rt <- 
  resp_summary_exp2 %>% 
  filter(z_meanRT < -2.5 | z_meanRT > 2.5)

participants_removed <- 
  bind_rows(outlier_to, outlier_acc, outlier_rt) %>% 
  select(subj) %>% 
  mutate(subj = as.character(subj)) %>% 
  unique() %>% 
  pull()

```

Our criteria for removing outlier data were identical to Experiment 1. On average, trials ended with a timeout on `r spec_dec(100*mean(resp_summary_exp2$meanTO),2)`% of trials (SD = `r spec_dec(100*sd(resp_summary_exp2$meanTO),2)`). `r Words(nrow(outlier_to))` participants had an usually high proportion of timeouts. The mean accuracy of participants (not including timeout trials) was `r spec_dec(100*mean(resp_summary_exp2$meanAcc),2)`% (SD = `r spec_dec(100*sd(resp_summary_exp2$meanAcc),2)`%). `r Words(nrow(outlier_acc))` participant had an unusually low proportion of accurate trials and were removed from the sample. `r Words(nrow(outlier_rt))` participants were deemed to be an outlier in terms of mean RT.

```{r rm_outliers_exp2}

data_exp2_OR <- 
  data_exp2 %>% 
  filter(!subj %in% participants_removed)

data_exp2_OR <- 
  data_exp2_OR %>% 
  filter(timeout == 0,
         acc == 1) %>% 
  group_by(subj) %>% 
  mutate(zRT = scale(RT)[,1]) # calculate z scores on participant basis

rt_outlier_summary <- 
  data_exp2_OR %>% 
  group_by(subj) %>% 
  summarise(prop_rem = mean(zRT < -2.5 | zRT > 2.5))

# was anyone an outlier in prop removed?
outlier_prop_removed <- 
  rt_outlier_summary %>% 
  mutate(z_prop_rem = scale(prop_rem)[,1]) %>% 
  filter(z_prop_rem < -2.5 | z_prop_rem > 2.5)

data_e2_f <-
  data_exp2_OR %>%
  ungroup() %>%
  filter(zRT > -2.5 & zRT < 2.5) # keep data in this range

```

For the remaining `r words(nrow(rt_outlier_summary))` participants we removed trials with a timeout and inaccurate trials, before removing outliers from the RT data. On average, the proportion of outliers removed was `r spec_dec(100*mean(rt_outlier_summary$prop_rem),2)`% (SD = `r spec_dec(100*sd(rt_outlier_summary$prop_rem),2)`%). `r Words(nrow(outlier_prop_removed))` participant had an unusual proportion of trials removed as outlier RTs and were not included in the final analysis.

```{r Exp2-RT-figure, fig.align="center", fig.cap="(ref:Exp2-RT-figure)", fig.dim=c(6,6), include = TRUE}

factorCols <- c("subj","TT","patType", "patArrowP1", "tQuad")
data_e2_f[factorCols] <- lapply(data_e2_f[factorCols], factor)
data_e2_f$TT <- recode_factor(data_e2_f$TT, "1" = "repeated", "2" = "random")
data_e2_f$patArrowP1 <- recode_factor(data_e2_f$patArrowP1, "1" = "arrow", "2" = "no arrow")

factorLbls <- c("Repeated: Arrow", "Random: Arrow", "Repeated: No arrow", "Random: No arrow")

# compute grand mean RT 
grand_mean_e2 <- mean(data_e2_f$RT)

# create subj level mean and normalised RT variable
data_e2_f <- 
  data_e2_f %>%
  group_by(subj) %>% 
  mutate(subj_mean_rt = mean(RT),
         normRT = RT - subj_mean_rt + grand_mean_e2) %>% 
  select(-subj_mean_rt)

# summarise the data across the 10 epochs, by subj
rt_summary_data_e2 <- 
  data_e2_f %>% 
  group_by(subj, patArrowP1, epoch, TT) %>% 
  summarise(meanRT = mean(RT),
            mean_norm_RT = mean(normRT)) # used for normalised SE bars


# summarise at the group level and plot
rt_summary_data_e2 %>% 
  group_by(epoch, patArrowP1, TT) %>% 
  summarise(group_RT = mean(meanRT),
            group_SE = sd(mean_norm_RT)/sqrt(n())) %>% 
  ggplot(aes(x = epoch, y = group_RT, group = interaction(TT, patArrowP1))) +
  geom_line()+
  geom_errorbar(aes(ymin = group_RT - group_SE,
                    ymax = group_RT + group_SE),
                width = .2) +
  geom_point(aes(fill = interaction(TT, patArrowP1),
                 shape = interaction(TT, patArrowP1)), size = 5) +
  scale_fill_manual(name = "",
                    labels = factorLbls,
                    values= c(cbPalette[c(1,3)],c(cbPalette[c(1,3)]))) +
  scale_shape_manual(name = "",
                     labels = factorLbls,
                     values = c(21,21,22,22)) +
  labs(y = "RT (ms)",
       x = "Epochs of 32 trials") +
  theme(legend.text = element_text(size = 10),
        legend.spacing.x = unit(0.4, "cm"),
        legend.position = c(0.75,.75),
        legend.direction = "vertical") +
  guides(fill = guide_legend(byrow = TRUE)) +
  scale_y_continuous(limits = c(1200, 2800), breaks = seq(1200, 2800, 200)) 

```

```{r phase_1_BFs_exp2}
# Statistics on Stage 1

phase_1 <- 
  rt_summary_data_e2 %>% 
  mutate(epoch = as.factor(epoch)) %>% 
  filter(epoch %in% c(1:5))
  
# traditional anova
aov_car(meanRT ~ Error(subj/patArrowP1*TT*epoch), data = phase_1)


phase_1_BF <- 
  anovaBF(meanRT ~ patArrowP1*TT*epoch + subj,
          data= data.frame(phase_1),
          whichRandom = "subj")

# does the interaction of TT and cue add anything?
int_effect <- phase_1_BF[16]/phase_1_BF[14]


```

(ref:Exp2-RT-figure) RT data for Experiment 2. Error bars show standard error of the mean on normalised data.

Figure \@ref(fig:Exp2-RT-figure) shows the RT data across the 10 epochs of the experiment. Contextual cuing emerged rapidly in both the arrow and no-arrow conditions, with little suggestion that the CC effect was different in the two conditions. The Phase 1 data were explored with a Bayesian ANOVA, which revealed that the best fitting model contained the factors of epoch, configuration (repeated vs. random), and endogenous cue (arrow present vs. arrow absent), with no interaction terms, `r report_BF_and_error(phase_1_BF[8])`. The next best fitting model contained all three factors and the interaction of epoch and configuration, `r report_BF_and_error(phase_1_BF[14])`, and this model was not a substantially worse fit to the data, `r report_BF_and_error(phase_1_BF[14]/phase_1_BF[8], sci_not = FALSE, hyp = "mc")`. All other models were substantially worse fits than the best fitting model, largest `r report_BF_and_error(phase_1_BF[11]/phase_1_BF[14], sci_not = FALSE, hyp = "mc")`. Importantly, the interaction term between the factors of endogenous cue and configuration did not improve the fit of the model, with support for the absence of this interaction, `r report_BF_and_error(phase_1_BF[11]/phase_1_BF[8], sci_not = FALSE, hyp = "mc")`.

```{r phase_2_BFs_exp2}
# Statistics on Stage 2

phase_2 <- 
  rt_summary_data_e2 %>% 
  mutate(epoch = as.factor(epoch)) %>% 
  filter(epoch %in% c(6:10))

aov_car(meanRT ~ Error(subj/patArrowP1*TT*epoch), data = phase_2)

# no evidence for an interaction of arrow training and TT
# is there evidence for the null?
phase_2_BF <- 
  anovaBF(meanRT ~ patArrowP1*TT*epoch + subj,
          data= data.frame(phase_2),
          whichRandom = "subj")

int_effect_phase2 <- phase_2_BF[11]/phase_2_BF[8]
# the evidence favours an absence of an interaction effect


```

When the endogenous cue was removed in the second half of the experiment, RTs were equivalent across the two conditions. An effect of configuration was seen for both cuing conditions, with little discernible difference between the size of the cuing effects. We conducted a Bayesian ANOVA with factors of epoch, configuration and endogenous cue condition (arrow vs. no-arrow). The best fitting model was that with just the factors of epoch and configuration with no interaction between the factors, `r report_BF_and_error(phase_2_BF[7])`. There was substantial support for this model over the next best fitting model, `r report_BF_and_error(phase_2_BF[7]/phase_2_BF[8], sci_not = FALSE, hyp = "mc")`. To examine the interaction of the configuration and endogenous cue factors, we compared the model containing those two factors to the model containing the two factors plus the interaction of configuration and endogenous cue, which revealed support for the absence of an interaction, `r report_BF_and_error(phase_2_BF[10]/phase_2_BF[6], sci_not = FALSE, hyp = "mc")`.

```{r all_data_BFs_exp2}
# Statistics on Stage 2

all_exp2 <- 
  rt_summary_data_e2 %>% 
  mutate(epoch = as.factor(epoch)) %>% 
  filter(epoch %in% c(1:10))

all_exp2_BF <- 
  anovaBF(meanRT ~ patArrowP1*TT + subj,
          data= data.frame(all_exp2),
          whichRandom = "subj")

```

To provide further support for the absence of the interaction between the factors of configuration type and endogenous cue, the data from across the experiment (epochs 1-10) were analysed with a Bayesian ANOVA with only the factors of configuration and endogenous cue. The best fitting model was that with the two factors and no interaction, `r report_BF_and_error(all_exp2_BF[3])`. The addition of the interaction term did not strengthen the model, with considerable support evident for the absence of the interaction, `r report_BF_and_error(all_exp2_BF[4]/all_exp2_BF[3], sci_not = FALSE, hyp = "mc")`.

## Discussion

Experiment 2 sought to examine whether the presence of a valid endogenous cue would impair the acquisition of a contextual cuing effect. In the first phase, two sets of configurations were trained, one of which was always presented in the presence of the endogenous cue, and one set which was presented without the endogenous cue. Overall there was considerable evidence that the cue was processed and acted upon, as response times to the target were much faster on cued trials. However, there was no evidence to suggest that this initial guidance of attention impaired the acquisition of the configurations on those trials. Furthermore, when the endogenous cue was never presented in the final phase of the experiment, the size of the contextual cuing effect was equivalent between the two sets of configurations; the Bayesian analyses found support for the equivalence of these CC effects.

The lack of competition effects seen in Experiment 2 are at odds with some findings in the CC literature [i.e., @endo2004; @kunar2014], where competition has been seen by more dominant or salient features of the displays. Instead, the findings point towards a more automatic nature to contextual cuing, whereby associations form ubiquitously, so long as they receive the focus of attention at some point within the search process [e.g., @beesley2012].

Taken together with the findings of Experiment 1, these data suggest that attention can be initially cued in an endogenous manner, before the underlying search configuration refines this attentional process to facilitate search for the target in repeated configurations. The equivalence of the CC effects in the two conditions (cued and uncued) suggests that the guidance by the context was driven largely (or perhaps entirely) by the distractors that appear close to the target. That is, while search times are longer in the uncued condition, and therefore more distractors are inevitably processed in this condition, this additional distractor processing does not result in stronger associative learning. Experiment 3 explored this hypothesis.

# Experiment 3

Existing data from studies of contextual cuing has pointed towards a localised learning effect for repeated configurations, with those distractors closest to the target being preferentially weighted in the learning process over those located further from the target. For example, @olson2002 trained participants with three sets of repeating configurations that differed in terms of which distractors repeated across trials. For one set, the entire global context (all of the distractors) repeated, while for the other two sets only the short-range (those close to the target) or the long-range distractors (those far from the target) repeated across trials. They found no difference between the CC effect in the short-range and global configurations, while the CC effect was not significant for the long-range context. Similar results have been shown by @brady2007 which led to the development of the spatial constraints model of contextual cuing, in which distractor-target associations occurring in close proximal space are weighted more heavily in the learning process (over those occurring across greater spatial distance).

It is important to consider how the bias towards local learning may interact with the attentional scanning process during contextual cuing. The analysis of eye-movements during contextual cuing tasks [@beesley2018; @tseng2004] has revealed a characteristic scanning pattern comprising two phases: search initially occurs in a seemingly random manner, as the eyes move between distractors in the central region of the distractor field, before then moving in a more directed manner towards the target position. Contextual cuing appears to result from a cessation of the first (random) search phase at an earlier time point in the entire search process, such that processing of repeated distractors will, on average, result in fewer fixations. With respect to the current study, in Experiments 1 and 2 we have initially directed attention towards the side of the screen that contains the target on cued trials. This will bring about an early cessation of the first phase of the search process. From here, however, it seems that eye-movements are still facilitated by the repetition of the context.

To test this characterisation of the interaction between the endogenous cue and the repeated context, we exposed participants to the same procedure as used in phase 1 of Experiment 1, which establishes a contextual cuing effect prior to the use of the endogenous cue. In a second phase we then presented the endogenous cue on every trial (as in Experiment 1), but we manipulated the presence of the repeated distractors within the configurations. For each repeated configuration we created two variations: in the "proximal" configurations, only the distractors in the quadrant containing the target match those from the full repeated configuration, while the distractors in the other three quadrants were randomly arranged on each trial; in the "distal" configurations, the distractors closest to the target were randomised, while the distractors in the other three quadrants were the same as those in the full repeated configuration. During this phase we also presented fully repeated configurations and fully randomised configurations. Comparison of the response times across these four trial types will allow us to determine the contribution of proximal and distal distractors to the CC effect in this task.

## Method

### Participants

```{r}

# get basic stats for Ps

data_exp3 <- 
  data_raw %>% 
  filter(exp == "CCC03") 

# rename TT variable
data_exp3 <- 
  data_exp3 %>% 
  mutate(TT = fct_recode(TT, 
                         "Repeated DISTAL" = "global (local random)",
                         "Repeated PROXIMAL" = "local (global random)",
                         "Random" = "random",
                         "Repeated" = "repeated")) %>% 
  mutate(TT = fct_relevel(TT, 
                          "Repeated", 
                          "Random", 
                          "Repeated DISTAL", 
                          "Repeated PROXIMAL"))

demographics <- 
  data_exp3 %>% 
  group_by(subj) %>% 
  slice(1) %>% 
  select(subj, age, gender)

```

`r Words(nrow(demographics))` undergraduate students from Lancaster University were recruited (mean age = `r mean(demographics$age)`, SD = `r sd(demographics$age)`; `r count(demographics[,2:3], gender)[1,2]` identified as male and `r count(demographics[,2:3], gender)[2,2]` as female) via the Psychology Research Participation System in the Department of Psychology at Lancaster University, in return for the opportunity to use the recruitment system for their own research in future years.

### Materials

The experiment was conducted in a quiet testing cubicle, as described in Experiment 2. All other materials and stimuli were identical to Experiment 1.

### Design

The design of phase 1 was identical to Experiment 1, with four repeated configurations created and presented with random configurations during this phase. For Phase 2, each of the four configurations was manipulated to create two alternative conditions. In the "Repeated distal" condition, the four distractors in the target quadrant were randomly arranged on each trial, while the 12 distractors in the other three quadrants were presented in the same positions as had been trained in Phase 1. Thus, slower response times for this condition (compared to the fully repeated configurations) would indicate the extent to which participants CC was governed by the distractors closest to the target. For the "Repeated proximal" condition, the four distractors in the target quadrant were presented in the same positions as had been trained in Phase 1, while the 12 distractors in the other three quadrants were randomly arranged on each trial. Thus, slower response times for this condition (compared to the fully repeated configurations) would indicate the extent to which CC was governed by the distractors further from the target. Comparison of the RTs for these different configurations with those of the random configurations would allow for the assessment of whether these subsets of distractors had *any* contribution to the CC effect that had developed during phase 1.

### Procedure

The procedure was identical to Experiment 1.

## Results

```{r}

# participant exclusions 

to_summary <- 
  data_exp3 %>% 
  group_by(subj) %>% 
  summarise(meanTO = mean(timeout)) %>% 
  mutate(z_meanTO = scale(meanTO)[,1])

acc_summary <- 
  data_exp3 %>% 
  group_by(subj) %>% 
  summarise(meanAcc = mean(acc, na.rm = TRUE)) %>% 
  mutate(z_meanAcc = scale(meanAcc)[,1])

rt_summary <- 
  data_exp3 %>% 
  filter(acc == 1) %>% 
  group_by(subj) %>% 
  summarise(meanRT = mean(RT, na.rm = TRUE)) %>% 
  mutate(z_meanRT = scale(meanRT)[,1])

resp_summary_exp3 <- 
  to_summary %>% 
  left_join(acc_summary, by = "subj") %>% 
  left_join(rt_summary, by = "subj")

# is anyone an outlier in terms of timeouts?
outlier_to <- 
  resp_summary_exp3 %>% 
  filter(z_meanTO < -2.5 | z_meanTO > 2.5)

# is anyone an outlier in terms of accuracy?
outlier_acc <- 
  resp_summary_exp3 %>% 
  filter(z_meanAcc < -2.5 | z_meanAcc > 2.5)

# is anyone an outlier in terms of rt?
outlier_rt <- 
  resp_summary_exp3 %>% 
  filter(z_meanRT < -2.5 | z_meanRT > 2.5)

participants_removed <- 
  bind_rows(outlier_to, outlier_acc, outlier_rt) %>% 
  select(subj) %>% 
  mutate(subj = as.character(subj)) %>% 
  unique() %>% 
  pull()

```

Our criteria for removing outlier data were identical to Experiment 1. On average, trials ended with a timeout on `r spec_dec(100*mean(resp_summary_exp3$meanTO),2)`% (SD = `r spec_dec(100*sd(resp_summary_exp3$meanTO),2)`) of trials . `r Words(nrow(outlier_to))` participants had an usually high proportion of timeouts and were removed from the sample. The mean accuracy of participants (not including timeout trials) was `r spec_dec(100*mean(resp_summary_exp3$meanAcc),2)`% (SD = `r spec_dec(100*sd(resp_summary_exp3$meanAcc),2)`%). `r Words(nrow(outlier_acc))` participants that had an unusually low proportion of accurate trials and were also removed. `r Words(nrow(outlier_rt))` participants were deemed to be an outlier in terms of mean RT.

```{r}

data_exp3_OR <- 
  data_exp3 %>% 
  filter(!subj %in% participants_removed)

data_exp3_OR <- 
  data_exp3_OR %>% 
  filter(timeout == 0,
         acc == 1) %>% 
  group_by(subj) %>% 
  mutate(zRT = scale(RT)[,1]) # calculate z scores on participant basis

rt_outlier_summary <- 
  data_exp3_OR %>% 
  group_by(subj) %>% 
  summarise(prop_rem = mean(zRT < -2.5 | zRT > 2.5))

# was anyone an outlier in prop removed?
outlier_prop_removed <- 
  rt_outlier_summary %>% 
  mutate(z_prop_rem = scale(prop_rem)[,1]) %>% 
  filter(z_prop_rem < -2.5 | z_prop_rem > 2.5)

data_e3_f <-
  data_exp3_OR %>%
  ungroup() %>%
  filter(zRT > -2.5 & zRT < 2.5) # keep data in this range

```

For the remaining `r words(nrow(rt_outlier_summary))` participants we removed trials with a timeout and inaccurate trials, before removing outliers from the RT data. On average, the proportion of outliers removed was `r spec_dec(100*mean(rt_outlier_summary$prop_rem),2)`% (SD = `r spec_dec(100*sd(rt_outlier_summary$prop_rem),2)`%). `r Words(nrow(outlier_prop_removed))` participants had an unusual proportion of trials removed as outlier RTs.

```{r Exp3-RT-figure, fig.align="center", fig.cap="(ref:Exp3-RT-figure)", fig.dim=c(7,5), include=TRUE}

grand_mean_e3 <- mean(data_e3_f$RT)

# create subj level mean and normalised RT variable
data_e3_f <- 
  data_e3_f %>%
  group_by(subj) %>% 
  mutate(subj_mean_rt = mean(RT),
         normRT = RT - subj_mean_rt + grand_mean_e3) %>% 
  select(-subj_mean_rt)


# summarise the data across the 10 epochs, by subj
rt_summary_data_e3 <-
  data_e3_f %>%
  group_by(subj, epoch, TT) %>%
  summarise(meanRT = mean(RT),
            normRT = mean(normRT))

# summarise at the group level and plot
rt_summary_data_e3 %>%
  group_by(epoch, TT) %>%
  summarise(group_RT = mean(meanRT),
            group_SE = sd(normRT)/sqrt(n())) %>%
  ggplot(aes(x = epoch, y = group_RT, group = TT, fill = TT)) +
  geom_line(size = .5) +
  geom_errorbar(aes(ymin = group_RT - group_SE,
                    ymax = group_RT + group_SE),
                width = .05) +
    geom_point(aes(fill = TT),size = 5, shape = 21, alpha = 1) +
  labs(y = "RT (ms)",
       x = "Epochs of 32 trials") +
  scale_fill_manual(name = "",
                    values = cbPalette[c(1,3,2,4)]) +
  theme(legend.text = element_text(size = 10),
        legend.spacing.x = unit(0.4, "cm"),
        legend.position = c(0.75,0.75),
        legend.direction = "vertical") +
  guides(fill = guide_legend(byrow = TRUE)) +
  scale_y_continuous(limits = c(1000, 2600), breaks = seq(1000, 2600, 200))


```

```{r}
# Statistics on Stage 1

phase_1 <- 
  rt_summary_data_e3 %>% 
  mutate(epoch = as.factor(epoch)) %>% 
  filter(epoch %in% c(1:5))

aov_car(meanRT ~ Error(subj/TT*epoch), data = phase_1)

exp3_p1_BFs <- anovaBF(meanRT ~ TT*epoch + subj,
                       whichRandom = "subj",
                       data = phase_1)

```

(ref:Exp3-RT-figure) RT data for Experiment 3. Error bars show standard error of the mean on normalised data.

Figure \@ref(fig:Exp3-RT-figure) shows the RT data across the 10 epochs of Experiment 3. As in Experiment 1, contextual cuing was readily established in Phase 1. These data were subjected to a Bayesian ANOVA which revealed that the best fitting model contained the factors of configuration (repeated vs. random) and epoch, and an interaction between those factors, `r report_BF_and_error(exp3_p1_BFs[4])`. However, the model without the interaction provided a strong fit to the data, `r report_BF_and_error(exp3_p1_BFs[3])`, and a comparison between the two models did not find significant evidence in support of the interaction term, `r report_BF_and_error(exp3_p1_BFs[3]/exp3_p1_BFs[4], sci_not = FALSE, hyp = "mc")`. The best fitting model was substantially supported over the remaining models, smallest `r report_BF_and_error(exp3_p1_BFs[4]/exp3_p1_BFs[1], sci_not = FALSE, hyp = "mc")`, providing considerable support for the factors of epoch and configuration.

```{r}
# Statistics on Stage 2

phase_2 <- 
  rt_summary_data_e3 %>% 
  mutate(epoch = as.factor(epoch)) %>% 
  filter(epoch %in% c(6:10))

aov_car(meanRT ~ Error(subj/TT*epoch), data = phase_2)

# Bayesian analysis of phase 2

exp3_p2_BFs <- anovaBF(meanRT ~ TT*epoch + subj,
                       whichRandom = "subj",
                       data = phase_2)

ttestBF_data <- 
  phase_2 %>% 
  group_by(subj, TT) %>% 
  summarise(meanRT=mean(meanRT)) %>% 
  pivot_wider(values_from = meanRT, names_from = TT) %>% 
  janitor::clean_names()

exp3_p2_rep_rand <- ttestBF(x = ttestBF_data$repeated, y = ttestBF_data$random, paired = TRUE)
exp3_p2_rep_global <- ttestBF(x = ttestBF_data$repeated, y = ttestBF_data$repeated_distal, paired = TRUE)
exp3_p2_rep_local <- ttestBF(x = ttestBF_data$repeated, y = ttestBF_data$repeated_proximal, paired = TRUE)
exp3_p2_global_rand <- ttestBF(x = ttestBF_data$repeated_distal, y = ttestBF_data$random, paired = TRUE)
exp3_p2_local_rand <- ttestBF(x = ttestBF_data$repeated_proximal, y = ttestBF_data$random, paired = TRUE)
exp3_p2_global_local <- ttestBF(x = ttestBF_data$repeated_distal, y = ttestBF_data$repeated_proximal, paired = TRUE)



```

The response times decreased significantly with the presentation of the valid endogenous cue in Phase 2. Response times to the fully repeated configurations were somewhat comparable to those when just the proximal repeated distractors were present. Response times for the distal repeated distractors appeared to be slower and comparable to the fully random configurations. The Phase 2 data were subjected to a Bayesian ANOVA which found that the best fitting model contained the factors of configuration and epoch but no interaction between the factors, `r report_BF_and_error(exp3_p2_BFs[3])`. This model provided a superior fit to the data compared to the next best fitting model that included the two factors and the interaction term, `r report_BF_and_error(exp3_p2_BFs[3]/exp3_p2_BFs[4], sci_not = FALSE, hyp = "mc")`, providing strong support for the contribution of the two factors and the absence of an interaction between the two factors.

```{r Exp3-Phase-2-figure, fig.align="center", fig.cap="(ref:Exp3-Phase-2-figure)", fig.dim=c(5,4), include=TRUE}

# summarise at the group level and plot
phase_2_TT_e3 <- 
  rt_summary_data_e3 %>%
  filter(epoch %in% c(6,10)) %>% 
  group_by(TT) %>%
  summarise(group_RT = mean(meanRT),
            group_SE = sd(normRT)/sqrt(n()))

phase_2_TT_e3 %>%
  mutate(TT = fct_relevel(TT, "Repeated", "Repeated PROXIMAL",
                          "Repeated DISTAL", "Random")) %>% 
  ggplot(aes(x = TT, y = group_RT, fill = TT)) +
  geom_col(colour = "black", size = 1) +
  geom_errorbar(aes(ymin = group_RT - group_SE,
                    ymax = group_RT + group_SE),
                width = .05, size = 0.5
                ) +
  coord_cartesian(ylim = c(1100,1500)) +
  labs(y = "RT (ms)",
       x = "Configuration type") +
  scale_fill_manual(name = "",
                  values = cbPalette[c(1,3,2,4)]) +
  theme(legend.position = "None") +
  scale_x_discrete(labels = scales::label_wrap(10))


```

(ref:Exp3-Phase-2-figure) RT data for phase 2 of Experiment 3. Error bars show standard error of the mean on normalised data.

Figure \@ref(fig:Exp3-Phase-2-figure) shows the mean RTs to the four types of configuration, averaged across the 5 epochs of Phase 2 (see the Appendix for a plot of these data showing the distribution of individual data points for RT differences). To explore the differences in response times Bayesian t-tests were run for all pairwise comparisons using BayesFactor::ttestBF with the default Cauchy prior. The response times to repeated and repeated-proximal configurations were both faster than those to random configurations, smallest `r report_BF_and_error(exp3_p2_local_rand, sci_not = FALSE)`. In contrast, there was no evidence that the response times to repeated-distal configurations were different from those to random configurations, `r report_BF_and_error(exp3_p2_global_rand, sci_not = FALSE)`. Response times to repeated configurations were faster than those to repeated-proximal configurations, `r report_BF_and_error(exp3_p2_rep_local, sci_not = FALSE)`. Response times to repeated-proximal configurations were faster than those to repeated-distal configurations, `r report_BF_and_error(exp3_p2_global_local, sci_not = FALSE)`.

## Discussion

Experiment 3 explored the localisation of the distractors driving contextual cuing when attention is guided initially by an endogenous cue. As expected, there was substantial evidence that contextual cuing was present when the distractors close to the target were maintained, but not when these distractors were randomly arranged. These data provide confirmatory evidence for the hypothesised interplay between the two drivers of attention: initially attention is guided by the endogenous cue towards one half of the screen. Despite visual search never commencing in this manner in the first half of the experiment, a CC effect was readily observed, but only for those configurations in which the local distractors were present. Thus it seems that the stored representations of configurations surrounding target positions are very flexibly deployed in visual search. These data lend support to the notion that the effect of the repeated configuration comes late on in the visual search process, and that each trial commences with a random search process that is not guided by the repeated configuration [@beesley2018; @tseng2004].

# General Discussion

Three experiments explored the impact of a central endogenous cue on the contextual cuing of visual search. In Experiment 1, having established a contextual cuing effect, each trial was preceded by an central endogenous cue of attention in the form of an arrow, directing attention towards the side of the screen in which the target was positioned (this arrow cue was always valid in each of the three experiments). Despite participants clearly using this cue, visual search was still facilitated by the presence of the repeating pattern of visual search. This experiment demonstrated that, once acquired, the activation of the memory representation and its impact on performance of visual search remains intact in the presence of a top-down instruction to guide attention. Experiment 2 examined the storage of these contextual representations, and whether these were impaired by an endogenous cue guiding search. We found equivalent levels of contextual cuing for two sets of configurations, one of which was paired with the cue and one which was not. Together, these two experiments suggest a seamless interplay between these two factors governing attention in visual search: the endogenous cue initially guides attention and the repeated configuration continues to refine and guide attention towards a fixation on the target. In Experiment 3 we therefore explored whether the localised distractors around the target were sufficient to generate CC following the guidance by the endogenous cue. Indeed, the CC effect was as large in the case of the proximal distractors compared to the entire repeated configuration of distractors. In contrast, those repetitions that did not contain the proximal distractors failed to generate a CC effect.

The effect of CC on visual search has frequently been characterised as an automatic influence on behaviour [e.g., @chun1998; @chun2000a; @geyer2021]. This characterisation of CC comes from multiple aspects of the observed effect. Updating of the associations is somewhat slow and seemingly inflexible to changes in the acquired associations [e.g., ; @zellin2013; @makovski2011; @manginelli2009], and therefore perhaps reflects a habitual form of behaviour. In addition, contextual cuing has frequently been observed in the absence of above-chance recognition memory for the repeating search configurations [e.g., @colagiuri2016], which suggests a non-conscious, automatically evoked form of behaviour. Despite this persistent characterisation, the automaticity (or controllability) of CC has rarely been directly tested in the literature. To our knowledge, only the experiments of Luque and colleagues [@luque2017b; @luque2021] have directly assessed this aspect of CC, by placing the influence of the configuration in competition with top-down goals in the task. Their findings supported the conclusion that CC performance can be controlled and will not guide search for the target when another aspect of the task governs attentional control. In the current study, the repeated configurations continued to have an influence on search performance even when attention had been guided by the endogenous cue. These results are therefore somewhat at odds with the conclusions of Luque and colleagues [@luque2017b; @luque2021].

To what extent is this behaviour best characterised as "automatic" in nature? Arguably the clearest demonstration of an automatic effect of a stimulus on behaviour is when the associated behaviour is elicited even when it is counter-productive to the current goals [ref]. Such a test was constructed in the repeated inconsistent trials of Experiment 1, in which the repeated configuration was associated with a target appearing in a position that was in the opposite side of the screen to the direction of the endogenous cue. If the repeated configuration was having an effect on behaviour on these trials we would have expected to see slower response times compared to random trials. This was not the case: response times were equivalent in the two conditions. As such it has hard to claim here that the configuration is having an *automatic* effect on behaviour, according to this strict characterisation of such an effect. Nevertheless, the experiments here reveal an interplay between top-down processes and stimulus driven effects on attention in CC.

The current data reveal that the influence of repeated contexts has a relatively late control on behaviour in visual search. Previous analysis of eye-movements during CC [@beesley2018; @tseng2004] has shown that contextual cuing (and visual search more generally) has two characteristic components. The first of these is an inefficient search process where search fails to move towards the target in trials with more fixations. This is followed by a phase in which monotonic, positive increments are made toward the target position in the final 3 to 4 fixations. CC reduces the frequency of trials with the initial (random) search period (there are more of such trials for random configurations and fewer for repeated configurations). Thus, the effect of the endogenous central cue in the current study is to eliminate, or considerably reduce, the engagement with this first phase of the search process. The results of this study strongly imply that the positive associative information in the repeating configurations is extracted in the final stages of search and is localised to the target. This true both in terms of the performance of an acquired configuration (Experiments 1 and 3) and the acquisition of the representation for that configuration (Experiment 2). Perhaps paradoxically, the benefit of repeated configurations in search occurs shortly before the target is fixated.

In conclusion....

\newpage

# Appendix

```{r Exp3-Phase-2-RTdiff-figure, fig.align="center", fig.cap="(ref:Exp3-Phase-2-RTdiff-figure)", fig.dim=c(5,4), include=TRUE}

rt_summary_data_e3 %>%
  filter(epoch %in% c(6,10)) %>% 
  group_by(subj,TT) %>%
  summarise(meanRT = mean(meanRT)) %>% 
  pivot_wider(names_from = TT, values_from = meanRT) %>% 
  janitor::clean_names() %>% 
  mutate(repeated = random - repeated,
         repeated_distal = random - repeated_distal,
         repeated_proximal = random - repeated_proximal) %>% 
  select(-random) %>% 
  pivot_longer(cols = c("repeated", "repeated_distal", "repeated_proximal"), 
               names_to = "TT", values_to = "meanRT") %>% 
  mutate(TT = fct_relevel(TT, "repeated", "repeated_proximal", "repeated_distal")) %>% 
  ggplot(aes(x = TT, y = meanRT)) +
  geom_violin(aes(fill = TT), alpha = .5) +
  geom_jitter(width = .05) +
  geom_line(aes(group = subj), alpha = .3) +
  scale_fill_manual(name = "",
                  values = cbPalette[c(1,3,2,4)]) +
  labs(y = "CC effect (RT difference from random)") +
  theme(legend.position = "None")
  
```

(ref:Exp3-Phase-2-RTdiff-figure) The distribution of RT data for phase 2 of Experiment 3, plotted as difference scores (RT to random configurations minus RT to repeated configuration type). Individual points are presented and linked across trial types.

\newpage

# References
